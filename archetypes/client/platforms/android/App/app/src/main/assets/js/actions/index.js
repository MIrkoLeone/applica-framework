"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r["default"]=e,r}Object.defineProperty(exports,"__esModule",{value:!0}),exports.recover=exports.registrationError=exports.registrationComplete=exports.register=exports.logout=exports.resumeSession=exports.login=exports.REGISTRATION_ERROR=exports.REGISTRATION_COMPLETE=exports.REGISTER=exports.RECOVER=exports.LOGOUT=exports.RESUME_SESSION=exports.LOGIN=void 0;var _aj=require("../aj"),aj=_interopRequireWildcard(_aj),_session=require("../api/session"),session=_interopRequireWildcard(_session),_account=require("../api/account"),account=_interopRequireWildcard(_account),_responses=require("../api/responses"),responses=_interopRequireWildcard(_responses),_plugins=require("../plugins"),_strings=require("../strings"),_strings2=_interopRequireDefault(_strings),LOGIN=exports.LOGIN="LOGIN",RESUME_SESSION=exports.RESUME_SESSION="RESUME_SESSION",LOGOUT=exports.LOGOUT="LOGOUT",RECOVER=exports.RECOVER="RECOVER",REGISTER=exports.REGISTER="REGISTER",REGISTRATION_COMPLETE=exports.REGISTRATION_COMPLETE="REGISTRATION_COMPLETE",REGISTRATION_ERROR=exports.REGISTRATION_ERROR="REGISTRATION_ERROR",login=exports.login=aj.createAction(LOGIN,function(e){return _.isEmpty(e.mail)||_.isEmpty(e.password)?void _plugins.alert("Cannot login","Email and password are required","warning"):(_plugins.showLoader(),void session.start(e.mail,e.password).then(function(e){_plugins.hideLoader(),aj.dispatch({type:LOGIN,user:e,isLoggedIn:!0}),_plugins.toast(_strings2["default"].welcome+" "+e.name)})["catch"](function(){_plugins.hideLoader(),aj.dispatch({type:LOGIN,user:null,isLoggedIn:!1}),_plugins.alert(_strings2["default"].ooops,_strings2["default"].badLogin,"error")}))}),resumeSession=exports.resumeSession=aj.createAction(RESUME_SESSION,function(){session.resume().then(function(e){_plugins.hideLoader(),aj.dispatch({type:RESUME_SESSION,user:e,isLoggedIn:!0}),_plugins.toast(_strings2["default"].welcome+" "+e.name)})["catch"](function(){_plugins.hideLoader(),aj.dispatch({type:RESUME_SESSION,user:null,isLoggedIn:!1})})}),logout=exports.logout=aj.createAction(LOGOUT,function(){session.destroy().then(function(){aj.dispatch({type:LOGOUT})})}),register=exports.register=aj.createAction(REGISTER,function(e){aj.dispatch({type:REGISTER}),_plugins.showLoader(_strings2["default"].registering),account.register(e.name,e.mail,e.password).then(function(){registrationComplete({name:e.name,mail:e.mail})})["catch"](function(e){_plugins.alert(_strings2["default"].ooops,responses.msg(e),"error"),registrationError({errorCode:e})})}),registrationComplete=exports.registrationComplete=aj.createAction(REGISTRATION_COMPLETE,function(e){aj.dispatch({type:REGISTRATION_COMPLETE,mail:e.mail,name:e.name})}),registrationError=exports.registrationError=aj.createAction(REGISTRATION_ERROR,function(e){aj.dispatch({type:REGISTRATION_ERROR,error:e.errorCode})}),recover=exports.recover=aj.createAction(RECOVER,function(){aj.dispatch({type:RECOVER,loading:!0})});